'''
Created on 2018年5月3日

@author: zhang
'''
import re

def jiajian(s):
    sum = 0
    r = re.compile(r'-?[\d\.]+|\+|-')
    print(s)
    f = re.findall(r, s)
    print(f)
    #处理连续的两个符号,'--','-+'
    for i in range(len(f)):
        if f[i] == '-':
            if f[i+1]=='-':
                f[i]='+'
                f[i+1] = '+'
            if f[i+1] == '+':
                f[i] = '+'
                f[i+1] = '-'
                
        
    for j in range(len(f)):
        if f[j] =='-':
            f[j] = '+'
            f[j+1] = float(f[j+1])*-1
            print(f[j+1])
    for i in f:
        if i == '+':
            i = 0
        sum += float(i)
        
    return str(sum)   


def chengchu(s):
    r = re.compile(r'-?[\d\.]+[\*/]-?[\d\.]+')
    while re.search(r'[\*/]', s):
    #处理乘除
        ma = re.search(r, s).group()
        print(ma)
        li = re.findall('-?[\d\.]+|\*|/', ma)
        print(li)
        if li[1] == '*':
            result = str(float(li[0])*float(li[2]))
        else:
            result = str(float(li[0])/float(li[2]))
        s = s.replace(ma,result)
        
    return s
        
#处理没有括号的        
def simple(s):
    return jiajian(chengchu(s))
#处理有括号的
def complex(s):
    while '(' in s:
        reg = re.compile(r'\([^\(\)]+\)')
        ma = re.search(reg, s).group()
        print(ma)
        result = simple(ma[1:-1])
        s = s.replace(ma, result)
        print(s)
    return simple(s)

ss='1 - 2 * ( (60-30 +(-40/5) * (9-2*5/3 + 7 /3*99/4*2998 +10 * 568/14 )) - (-4*3)/ (16-3*2) )'.replace(' ', '')
print (complex(ss))